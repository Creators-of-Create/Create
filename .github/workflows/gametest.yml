name: gametest
on: [ pull_request, push, workflow_dispatch ]

jobs:
    build:
        strategy:
            matrix:
                java: [ 17 ]
        runs-on: ubuntu-latest
        steps:

            - name: checkout repository
              uses: actions/checkout@v2

            - name: setup jdk ${{ matrix.java }}
              uses: actions/setup-java@v1
              with:
                  java-version: ${{ matrix.java }}

            - uses: actions/cache@v2
              with:
                path: ~/build/fg_cache
                key: ${{ runner.os }}-gradle-${{ hashFiles('**/gradle-wrapper.properties') }}
                restore-keys: ${{ runner.os }}-gradle

            - name: make gradle wrapper executable
              run: chmod +x ./gradlew

            - name: prepare to run gametests
              run: ./gradlew prepareRunGameTestServer

            - name: run gametests
              run: ./gradlew runGameTestServer
